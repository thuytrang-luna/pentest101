<?php
/**
 * This file adds a custom notice that recommends the installation of the Canvas plugin.
 *
 * @link       https://codesupply.co
 * @since      1.0.0
 *
 * @package    CNVSPort
 * @subpackage CNVSPort/includes
 */

/**
 * This class adds a custom notice that recommends the installation of the Canvas plugin.
 *
 * @since      1.0.0
 * @package    CNVSPort
 * @subpackage CNVSPort/includes
 * @author     Code Supply Co. <support@codesupply.co>
 */
class CNVSPort_Installer {

	/**
	 * Construct
	 */
	public function __construct() {
		add_action( 'admin_notices', array( $this, 'notice_installer' ) );
	}

	/**
	 * Output notice
	 */
	public function notice_installer() {
		if ( is_plugin_active( CNVSPORT_DEP_PATH ) ) {
			return;
		}

		if ( ! current_user_can( 'install_plugins' ) ) {
			return;
		}
		?>
		<div class="notice notice-error is-dismissible">
			<p><b><?php esc_html_e( 'Canvas Portfolio', 'canvas-portfolio' ); ?></b></p>

			<p>
				<?php
				/* Translators: Link of plugin */
				echo wp_kses( sprintf( __( 'Canvas Portfolio requires <a href="%s" target="_blank">Canvas</a> to be installed and active.', 'canvas-portfolio' ), "https://wordpress.org/plugins/$plugin_slug/" ), 'post' );
				?>
			</p>

			<p>
				<?php
				if ( is_wp_error( validate_plugin( CNVSPORT_DEP_PATH ) ) ) {
					// The plugin is not installed.
					$install_url = wp_nonce_url( admin_url( 'update.php?action=install-plugin&plugin=' . CNVSPORT_DEP_SLUG ), 'install-plugin_' . CNVSPORT_DEP_SLUG );
					?>
					<a class="install-now button-primary button" data-slug="canvas" href="<?php echo esc_url_raw( $install_url ); ?>">
						<?php esc_html_e( 'Install Now', 'canvas-portfolio' ); ?>
					</a>
					<?php
				} else {
					// The plugin is installed, so it just needs to be enabled.
					$activate_url = wp_nonce_url( admin_url( 'plugins.php?action=activate&plugin=' . CNVSPORT_DEP_PATH ), 'activate-plugin_' . CNVSPORT_DEP_PATH );
					?>
					<a class="activate-now button-primary button" data-slug="canvas" href="<?php echo esc_url_raw( $activate_url ); ?>">
						<?php esc_html_e( 'Activate Now', 'canvas-portfolio' ); ?>
					</a>
					<?php
				}
				?>
			</p>
		</div>
		<?php
	}
}

new CNVSPort_Installer();
