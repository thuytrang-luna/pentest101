<?php
/**
 * Portfolio Categories
 *
 * @var        $attributes - block attributes
 * @var        $options - layout options
 *
 * @link       https://codesupply.co
 * @since      1.0.0
 *
 * @package    Canvas Portfolio
 * @subpackage Canvas Portfolio/includes
 */

$class_name = cnvsport_portfolio_area_classes( $attributes, $options );

$categories = get_terms(
	array(
		'taxonomy'   => 'cnvsport-categories',
		'hide_empty' => false,
		'include'    => isset( $attributes['categories_filter_ids'] ) ? $attributes['categories_filter_ids'] : '',
		'orderby'    => isset( $attributes['categories_orderby'] ) ? $attributes['categories_orderby'] : 'name',
		'order'      => isset( $attributes['categories_order'] ) ? $attributes['categories_order'] : 'ASC',
		'number'     => isset( $attributes['number_items'] ) ? $attributes['number_items'] : null,
	)
);

if ( $categories ) {
	?>
	<div class="<?php echo esc_attr( $class_name ); ?>">

		<div class="cnvs-portfolio-area__outer">
			<div class="cnvs-portfolio-area__main" <?php cnvsport_portfolio_area_main_attrs( $attributes, $options ); ?>>
				<?php
				// Start the Loop.
				foreach ( $categories as $category ) {

					$attachment_id = get_term_meta( $category->term_id, 'cnvsport_featured_image', true );

					// Get item project.
					if ( wp_get_attachment_image( $attachment_id ) ) {

						$portfolio_entry = new CNVSPort_Entry(
							$attributes, $options
						);

						// Set settings.
						$portfolio_entry->object_id     = $category->term_id;
						$portfolio_entry->attachment_id = $attachment_id;

						// Init portfolio entry.
						$portfolio_entry->init();

						require apply_filters( 'cnvsport_portfolio_item_path', CNVSPORT_PATH . '/public/block/portfolio-entry.php', $attributes, $options, $portfolio_entry );
					}
				}
				?>
			</div>
		</div>
	</div>
	<?php
} else {
	require dirname( __FILE__ ) . '/post-area-none.php';
}

wp_reset_postdata();
